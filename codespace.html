<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daminī Codespace Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.min.js"></script>
    <style>
        :root { --bg: #0d1117; --side: #161b22; --border: #30363d; --accent: #7c3aed; --header: #161b22; }
        * { margin:0; padding:0; box-sizing:border-box; }
        body, html { height: 100%; background: var(--bg); color: #c9d1d9; font-family: 'Poppins', sans-serif; overflow: hidden; }

        header { height: 55px; background: var(--header); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; border-bottom: 1px solid var(--border); }
        .logo { display: flex; align-items: center; gap: 12px; font-weight: 800; color: #fff; }
        .logo i { color: var(--accent); font-size: 1.4rem; }

        .workspace { display: flex; height: calc(100vh - 55px); }
        
        .sidebar { width: 280px; background: var(--side); border-right: 1px solid var(--border); display: flex; flex-direction: column; transition: 0.2s; }
        .sidebar.collapsed { width: 0; overflow: hidden; }
        
        .toolbar { padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); font-size: 0.75rem; font-weight: 600; color: #8b949e; }
        .toolbar i { cursor: pointer; transition: 0.2s; margin-left: 10px; }
        .toolbar i:hover { color: var(--accent); }

        .file-tree { flex: 1; overflow-y: auto; padding: 10px 0; font-family: 'Fira Code', monospace; }
        .tree-item { padding: 6px 20px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 0.85rem; transition: 0.2s; }
        .tree-item:hover { background: #21262d; }
        .tree-item.active { background: #23863622; color: #fff; border-left: 3px solid var(--accent); }
        .indent { margin-left: 15px; border-left: 1px solid #30363d; }

        .editor-container { flex: 1; min-width: 0; background: #000; }
        #monaco-root { height: 100%; width: 100%; }

        .btn-group { display: flex; gap: 10px; }
        .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.75rem; display: flex; align-items: center; gap: 8px; color: #fff; transition: 0.2s; }
        .btn-run { background: #238636; }
        .btn-run:hover { background: #2ea043; }
        .btn-preview { background: var(--accent); }

        .fa-html5 { color: #e34c26; } .fa-css3 { color: #264de4; } .fa-js { color: #f7df1e; }
    </style>
</head>
<body>

    <header>
        <div class="logo">
            <i class="fas fa-terminal" onclick="toggleSidebar()"></i>
            <span>DAMINĪ <span style="color:var(--accent)">PRO</span></span>
        </div>
        <div class="btn-group">
            <button class="btn btn-preview" onclick="previewProject()"><i class="fas fa-eye"></i> PREVIEW</button>
            <button class="btn btn-run" onclick="runJS()"><i class="fas fa-play"></i> RUN JS</button>
        </div>
    </header>

    <div class="workspace">
        <aside class="sidebar" id="sidebar">
            <div class="toolbar">
                <span>EXPLORER</span>
                <div>
                    <i class="fas fa-file-medical" title="New File" onclick="addItem('file')"></i>
                    <i class="fas fa-folder-plus" title="New Folder" onclick="addItem('folder')"></i>
                </div>
            </div>
            <div class="file-tree" id="tree"></div>
        </aside>
        <main class="editor-container">
            <div id="monaco-root"></div>
        </main>
    </div>

<script>
    let editor;
    let fs = JSON.parse(localStorage.getItem('dm_fs_v5')) || [
        { id: '1', name: 'index.html', type: 'file', content: '<h1>Hello Daminī</h1>' },
        { id: '2', name: 'style.css', type: 'file', content: 'body { background: #000; color: purple; }' },
        { id: '3', name: 'src', type: 'folder', children: [] }
    ];
    let activeFile = fs[0];

    require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs' }});
    require(['vs/editor/editor.main'], function() {
        editor = monaco.editor.create(document.getElementById('monaco-root'), {
            value: activeFile.content,
            language: 'html',
            theme: 'vs-dark',
            automaticLayout: true,
            fontSize: 14,
            padding: { top: 20 }
        });

        editor.onDidChangeModelContent(() => {
            activeFile.content = editor.getValue();
            localStorage.setItem('dm_fs_v5', JSON.stringify(fs));
        });
        renderTree();
    });

    function addItem(type) {
        const name = prompt(`Enter ${type} name:`);
        if (!name) return;
        const item = { id: Date.now().toString(), name, type, content: type==='file'?'':null, children: type==='folder'?[]:null };
        
        const parentName = prompt("Parent folder (leave blank for root):");
        if (parentName) {
            const find = (list) => {
                for(let i of list) {
                    if(i.name === parentName && i.type === 'folder') return i;
                    if(i.children) { let res = find(i.children); if(res) return res; }
                }
            };
            const p = find(fs);
            if(p) p.children.push(item); else fs.push(item);
        } else fs.push(item);
        
        renderTree();
    }

    function renderTree() {
        const root = document.getElementById('tree');
        root.innerHTML = "";
        const build = (items, target) => {
            items.forEach(i => {
                const el = document.createElement('div');
                el.className = `tree-item ${i.id === activeFile.id ? 'active' : ''}`;
                let icon = i.type === 'folder' ? 'fa-folder' : 'fa-file-code';
                if(i.name.endsWith('.html')) icon = 'fab fa-html5';
                if(i.name.endsWith('.css')) icon = 'fab fa-css3';
                if(i.name.endsWith('.js')) icon = 'fab fa-js';

                el.innerHTML = `<i class="${icon}"></i> <span>${i.name}</span> <i class="fas fa-trash" style="margin-left:auto; font-size:10px" onclick="deleteItem('${i.id}')"></i>`;
                el.onclick = (e) => { if(!e.target.classList.contains('fa-trash')) openFile(i); };
                target.appendChild(el);
                if(i.children) {
                    const sub = document.createElement('div');
                    sub.className = "indent";
                    build(i.children, sub);
                    target.appendChild(sub);
                }
            });
        };
        build(fs, root);
    }

    function openFile(file) {
        if(file.type === 'folder') return;
        activeFile = file;
        const ext = file.name.split('.').pop();
        monaco.editor.setModelLanguage(editor.getModel(), ext === 'js' ? 'javascript' : ext);
        editor.setValue(file.content);
        renderTree();
    }

    function deleteItem(id) {
        const remove = (list) => {
            const idx = list.findIndex(i => i.id === id);
            if(idx > -1) list.splice(idx,1);
            else list.forEach(i => i.children && remove(i.children));
        };
        remove(fs); renderTree();
    }

    function previewProject() {
        const html = fs.find(f => f.name === 'index.html')?.content || "No index.html found";
        const blob = new Blob([html], { type: 'text/html' });
        window.open(URL.createObjectURL(blob), '_blank');
    }

    function runJS() {
        try { eval(editor.getValue()); } catch(e) { alert(e.message); }
    }

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('collapsed'); }
</script>
</body>
</html>
